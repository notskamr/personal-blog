---
export const prerender = false;
import { getPostWithSlug } from "../../utils/posts";
import PostLayout from "../../layouts/PostLayout.astro";
import type { BlogPost } from "../../utils/types";

const searchParams = new URL(Astro.request.url).searchParams;
const key = searchParams.get("key");
if (key !== "chicken-eating-food") {
  return new Response(
    JSON.stringify({
      status: 401,
      message: "You are not authorized to see this page.",
    })
  );
}
const { slug } = Astro.params;
if (!slug) {
  return new Response(
    JSON.stringify({
      status: 400,
      message: "No slug",
    })
  );
}
let post: BlogPost;
try {
  post = await getPostWithSlug(slug);
} catch {
  return new Response(
    JSON.stringify({
      status: 404,
      message: "This post doesn't exist",
    })
  );
}
---

<PostLayout
  navActive={false}
  postTitle={post.title}
  description={post.description}
  createdAt={post.date_created}
  updatedAt={post.date_created}
  content={post.content}
/>
